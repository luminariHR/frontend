import{r as i,j as e,i as D,B as b,u as M,S as L,L as P,C as F,_ as H}from"./index-BvEyhJvC.js";import{T as B,a as I,b as T,c as o,d as V,e as x}from"./table-D9qS8Jup.js";/* empty css                         */import{p as K,r as X,f as _,a as G,b as J}from"./approvalApi-R0l6ihfy.js";import{S as v}from"./pill-DWlxmmr_.js";import{u as Q}from"./index-CVyK_fVC.js";import{T as U}from"./editor-DVdwRWap.js";import{A as W}from"./ApprovalSteps-Nfj2jhE1.js";function Y({onClose:f,onRequestSubmit:u}){const[c,j]=i.useState(!0),[n,w]=i.useState(""),[d,m]=i.useState(""),[h,y]=i.useState([]),[N,g]=i.useState(!1),[S,p]=i.useState(!0),[r,s]=i.useState(null),a=t=>{if(t.length>0){const l=t[0];s(l),p(!0)}},{getRootProps:$,getInputProps:q,isDragActive:k}=Q({onDrop:a,maxFiles:1}),A=async()=>{const t=new FormData;t.append("image",r);const l=await K(t);if(l){const R=`<p>다음과 같이 경비 처리를 위한 결재를 요청드립니다.</p><br/><ul>
    <li>판매처: ${l.preview.store_name}</li>
    <li>사업자 번호: ${l.preview.store_business_number}</li>
    <li>매출일: ${l.preview.transaction_time}</li>
    <li>카드 정보:</li>
    <li class="ql-indent-1">카드 회사: ${l.preview.card_info.company}</li>
    <li class="ql-indent-1">카드 번호: ${l.preview.card_info.number}</li>
    <li>판매금액: ${l.preview.total_price}</li>
</ul><br/><p>위와 같은 내용으로 경비 처리를 요청드리오니, 검토 후 결재 부탁드립니다.</p><br/><p>감사합니다.</p>`;m(d+R)}p(!1)},O=()=>j(!c),z=t=>{m(t)},E=async()=>{const t=new FormData;t.append("title",n),t.append("content",d),h.map(R=>t.append("reviewer_ids",R.id)),r&&t.append("file",r),await X(t);const l=await _();l&&u(l),f()},C=()=>!!(n&&d&&h.length>0);return e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-30",children:e.jsx("div",{className:`relative flex bg-white rounded-lg shadow-lg overflow-hidden transition-all duration-300 ${c?"w-11/12 max-w-6xl":"w-11/12 max-w-4xl"} h-[90%]`,children:e.jsxs("div",{className:"flex flex-row w-full h-full",children:[e.jsx("div",{className:"flex-grow p-8 overflow-auto",children:e.jsxs("div",{className:"overflow-y-auto max-h-full h-full flex flex-col justify-between hide-scrollbar",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"결재 기안하기"}),e.jsx("button",{onClick:O,className:"px-4 py-2 mb-4 font-bold text-white bg-[#5d5bd4] rounded hover:bg-[#5553c1]",children:c?"결재선 숨기기":"결재선 보기"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-l font-semibold",children:"제목"}),e.jsx("div",{children:e.jsx("input",{id:"title",type:"text",value:n,placeholder:"결재 제목을 적어주세요.",onChange:t=>w(t.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 mt-4 mb-4 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",required:!0})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-l font-semibold",children:"파일 첨부"}),e.jsx("div",{className:"bg-gray-100 p-5 my-5 rounded-lg",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[!r&&e.jsxs("div",{...$(),className:`border-2 border-dashed rounded-lg p-6 text-center cursor-pointer ${k?"border-blue-500 bg-blue-50":"border-gray-300 bg-gray-50"}`,children:[e.jsx("input",{...q()}),k?e.jsx("p",{className:"text-blue-500",children:"파일을 여기에 드랍해주세요."}):e.jsx("p",{className:"text-gray-500",children:"Drag & drop a file here, or click to select a file"})]}),r&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-orange-200 rounded-lg flex items-center justify-center",children:e.jsx("img",{src:`https://img.icons8.com/color/48/000000/${r.type==="image/jpeg"?"image/jpg":r.type}.png`,alt:"doc",className:"w-6 h-6"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:r.name})}),e.jsx("div",{className:"cursor-pointer",onClick:()=>s(null),children:e.jsx(D,{})})]}),["image/jpeg","image/png","image/jpg","image/tiff"].includes(r.type)&&S&&e.jsxs("div",{className:"mt-6 bg-white p-4 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-700",children:"혹시 영수증을 첨부하셨나요?"}),e.jsx("div",{className:"cursor-pointer",onClick:()=>p(!1),children:e.jsx(D,{})})]}),e.jsx("button",{onClick:A,className:"mt-2 w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50",children:"OCR 분석하기"})]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-l font-semibold mb-3",children:"문서 양식"}),e.jsx(U,{value:d,onChange:z})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"mx-1",children:e.jsx(b,{text:"취소",onClick:f})}),e.jsxs("div",{className:"mx-1",onMouseEnter:()=>!C()&&g(!0),onMouseLeave:()=>g(!1),children:[C()?e.jsx(b,{text:"결재 요청",variant:"teams",type:"submit",onClick:E}):e.jsx(b,{text:"결재 요청",variant:"teams",type:"submit",disabled:!0}),!C()&&N&&e.jsx("div",{className:"absolute left-[50%] bottom-20 transform -translate-x-1/2 mt-2 px-3 py-1 text-sm text-white bg-gray-700 rounded shadow-lg",children:"제목, 양식, 결재선 등을 추가해주세요."})]})]})]})}),c&&e.jsx("div",{className:"w-80 p-6 bg-white border-r border-l-2 border-gray-200 flex-shrink-0 h-full overflow-auto",children:e.jsx(W,{data:h,setData:y})})]})})})}function ne(){const[f,u]=i.useState([]),[c,j]=i.useState(!1),[n,w]=i.useState("received"),[d,m]=i.useState(!0),h=M(),y=s=>{h(`/approval/details/${s}`)},N=[{id:"received",label:"받은 결재함"},{id:"sent",label:"보낸 결재함"},{id:"referenced",label:"참조 문서함"}],g=()=>j(!0),S=()=>j(!1),p=s=>new Date(s).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"}),r=s=>{switch(s){case"approved":return e.jsx(v,{status:"success",size:"sm",text:"승인"});case"pending":return e.jsx(v,{status:"pending",size:"sm",text:"검토 중"});case"rejected":return e.jsx(v,{status:"alert",size:"sm",text:"반려"});default:return e.jsx(v,{status:"default",size:"sm",text:"알 수 없음"})}};return i.useEffect(()=>{(async()=>{u([]);let a;n==="sent"?a=await _():n=="received"?a=await G():a=await J(),a.length>=0&&u(a),m(!1)})()},[n]),e.jsx(L,{children:e.jsxs(P,{children:[e.jsxs("div",{className:"flex flex-row justify-between mb-6",children:[e.jsxs("h2",{children:[e.jsx("span",{className:"text-[#8a8686]",children:"메인 >"})," ",e.jsx("span",{className:"font-semibold text-[#20243f]",children:"전자 결재"})]}),e.jsxs("h2",{className:"flex",children:[e.jsx("span",{children:e.jsx(F,{className:"text-gray-500 h-[20px]"})}),e.jsx("span",{className:"text-gray-500 ml-2 text-[14px]",children:"업무 외 개인정보 이용 금지"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mx-16",children:[e.jsx("div",{}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"flex justify-evenly space-x-4 bg-white py-2.5 px-5 rounded-full",children:N.map(s=>e.jsx("div",{onClick:()=>{m(!0),w(s.id)},className:`cursor-pointer px-4 py-2 rounded-full transition duration-300 ease-in-out ${n===s.id?"bg-[#5d5bd4] text-white shadow-md font-medium":"bg-white text-gray-600 font-medium"}`,children:e.jsxs("div",{className:"flex items-center",children:[s.label,s.count&&e.jsx("span",{className:`ml-2 rounded-full px-2 py-1 text-xs transition duration-300 ease-in-out ${n===s.id?"bg-yellow-500 text-white":"bg-yellow-100 text-yellow-500"}`,children:s.count})]})},s.id))})}),e.jsx(b,{text:"결재 기안하기",variant:"teams",addClass:"font-semibold",onClick:g})]}),e.jsxs("div",{className:"mx-16",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:c&&e.jsx(Y,{onClose:S,onRequestSubmit:u})}),e.jsx("div",{className:"transition duration-300 ease-in-out",children:e.jsx("div",{className:"overflow-auto rounded-lg",children:d?e.jsx("div",{className:"flex w-full justify-center items-center m-auto w-1/2 p-8",children:e.jsx(H,{color:"#5d5bd4",loading:d,size:50,"aria-label":"Loading Spinner","data-testid":"loader"})}):e.jsxs(B,{children:[e.jsx(I,{children:e.jsxs(T,{children:[e.jsx(o,{children:"상태"}),e.jsx(o,{children:"이름"}),e.jsx(o,{children:"요청"}),e.jsx(o,{children:"결재 라인"}),e.jsx(o,{children:"참조"}),e.jsx(o,{children:"생성일"})]})}),e.jsx(V,{children:f.map(s=>e.jsxs(T,{addClass:"hover:bg-gray-100 cursor-pointer",onClick:()=>y(s.id),children:[e.jsx(x,{children:r(s.status)}),e.jsx(x,{children:s.title}),e.jsx(x,{children:s.drafter.name}),e.jsx(x,{children:s.review_steps.map(a=>a.reviewer.name).join(", ")}),e.jsx(x,{children:s.references.map(a=>a.referrer.name).join(", ")}),e.jsx(x,{children:s.created_at?p(s.created_at):"-"})]},s.id))})]})})})]})]})})}export{ne as default};
