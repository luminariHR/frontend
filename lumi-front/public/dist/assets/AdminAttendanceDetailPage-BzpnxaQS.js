import{k as P,u as $,r as a,j as e,S as B,L as H,C as L,B as i,_ as R}from"./index-BvEyhJvC.js";import{I as h}from"./input-D1N2lLD0.js";import{T as O,a as q,b as v,c,d as Z,e as r}from"./table-D9qS8Jup.js";/* empty css                         */import{u as G,b as D}from"./attendanceApi-B3UmLx3w.js";import{S as u}from"./pill-DWlxmmr_.js";import{D as N}from"./index-DN_9uyhM.js";import{C as S}from"./calendar-days-cSX7vrBg.js";import"./startOfMonth-HAbtygMl.js";function te(){const{id:j}=P(),T=$(),[J,z]=a.useState(new Date),[p,E]=a.useState(new Date),[k,A]=a.useState(new Date),[o,_]=a.useState(null),[d,m]=a.useState(null),[n,g]=a.useState({}),[y,f]=a.useState(!0),M=s=>{m(s);const t=o.find(l=>l.id===s);g({clock_in:t.clock_in?t.clock_in.split("T")[1].slice(0,8):"",clock_out:t.clock_out?t.clock_out.split("T")[1].slice(0,8):""})},F=async()=>{try{const s={...n,clock_in:n.clock_in?`${o.find(t=>t.id===d).date}T${n.clock_in}:00Z`:null,clock_out:n.clock_out?`${o.find(t=>t.id===d).date}T${n.clock_out}:00Z`:null};await G(d,s),alert("근태 기록이 수정되었습니다."),m(null),C()}catch(s){console.error("Error updating attendance:",s),alert("근태 기록 수정 중 오류가 발생했습니다.")}},I=()=>{m(null)},w=(s,t)=>{g({...n,[t]:s.target.value})},x=s=>{switch(s){case"out":return e.jsx(u,{status:"success",size:"sm",text:"업무 종료"});case"normal":return e.jsx(u,{status:"success",size:"sm",text:"업무중"});case"late":return e.jsx(u,{status:"pending",size:"sm",text:"지각"});case"rejected":return e.jsx(u,{status:"alert",size:"sm",text:"반려"});default:return e.jsx(u,{status:"default",size:"sm",text:"알 수 없음"})}},C=async()=>{const s=p.toISOString().split("T")[0],t=k.toISOString().split("T")[0];f(!0);const l=await D(j,s,t);l&&_(l.data),f(!1)};a.useEffect(()=>{(async()=>{const t=await D(j);t&&_(t.data),f(!1)})()},[j]),a.useEffect(()=>{let s;const t=()=>{z(new Date),s=requestAnimationFrame(t)};return s=requestAnimationFrame(t),()=>cancelAnimationFrame(s)},[]);const b=s=>{const t=new Date;t.setHours(0,0,0,0);const l=new Date(s);return l.setHours(0,0,0,0),l.getTime()===t.getTime()?"today-selected":""};return e.jsx(B,{children:e.jsxs(H,{children:[e.jsxs("div",{className:"flex flex-row justify-between mb-6",children:[e.jsxs("h2",{children:[e.jsx("span",{className:"text-[#8a8686]",children:"메인 > 근태 관리 > 전체 근태 관리 >"})," ",e.jsx("span",{className:"font-semibold text-[#20243f]",children:"근태 기록"})]}),e.jsxs("h2",{className:"flex",children:[e.jsx("span",{children:e.jsx(L,{className:"text-gray-500 h-[20px]"})}),e.jsx("span",{className:"text-gray-500 ml-2 text-[14px]",children:"업무 외 개인정보 이용 금지"})]})]}),e.jsxs("div",{className:"mx-16",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs("label",{className:"flex p-2 border rounded bg-white",children:[e.jsx(N,{selected:p,onChange:s=>E(s),dateFormat:"yyyy-MM-dd",className:"outline-none cursor-pointer caret-transparent",dayClassName:b}),e.jsx(S,{})]}),e.jsxs("label",{className:"flex p-2 border rounded bg-white",children:[e.jsx(N,{selected:k,onChange:s=>A(s),dateFormat:"yyyy-MM-dd",className:"outline-none cursor-pointer caret-transparent",dayClassName:b}),e.jsx(S,{})]}),e.jsx("div",{children:e.jsx(i,{text:"검색",size:"md",variant:"primary",onClick:C})})]}),e.jsx("div",{className:"overflow-auto rounded-lg ",children:y?e.jsx("div",{className:"flex w-full justify-center items-center m-auto w-1/2 p-8",children:e.jsx(R,{color:"#5d5bd4",loading:y,size:50,"aria-label":"Loading Spinner","data-testid":"loader"})}):e.jsxs(O,{children:[e.jsx(q,{children:e.jsxs(v,{children:[e.jsx(c,{children:"날짜"}),e.jsx(c,{children:"상태"}),e.jsx(c,{children:"출근 시각"}),e.jsx(c,{children:"퇴근 시각"}),e.jsx(c,{children:"근무 시간"}),e.jsx(c,{children:"특이사항"}),e.jsx(c,{})]})}),e.jsx(Z,{children:o&&o.length>0?o.map(s=>e.jsxs(v,{children:[e.jsx(r,{children:s.date?s.date:"-"}),e.jsx(r,{children:s.is_late?x("late"):s.is_early_leave?x("early_leave"):s.clock_out?x("out"):x("normal")}),e.jsx(r,{children:d===s.id?e.jsx(h,{value:n.clock_in,onChange:t=>w(t,"clock_in")}):e.jsx(h,{value:s.clock_in?s.clock_in.split("T")[1].slice(0,8):"",disabled:!0})}),e.jsx(r,{children:d===s.id?e.jsx(h,{value:n.clock_out,onChange:t=>w(t,"clock_out")}):e.jsx(h,{value:s.clock_out?s.clock_out.split("T")[1].slice(0,8):"",disabled:!0})}),e.jsx(r,{children:s.hours_worked?`${Math.floor(s.hours_worked)}시간 ${Math.round((s.hours_worked-Math.floor(s.hours_worked))*60)}분`:"-"}),e.jsx(r,{addClass:"truncate",children:s.clock_out_note?s.clock_out_note.length>30?s.clock_out_note.slice(0,30)+"...":s.clock_out_note:"-"}),e.jsx(r,{children:d===s.id?e.jsxs("div",{className:"flex justify-end",children:[e.jsx(i,{text:"저장하기",size:"sm",onClick:F,addClass:"mr-2"}),e.jsx(i,{text:"취소",size:"sm",onClick:I})]}):e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{text:"수정",size:"sm",onClick:()=>M(s.id)})})})]},s.id)):e.jsx("div",{className:"bg-white p-8 text-gray-500",children:e.jsx("p",{className:"",children:"해당 기간 동안의 근태 기록이 없습니다."})})})]})})]}),e.jsx("div",{className:"my-6 w-full flex justify-center",children:e.jsx(i,{text:"목록으로",onClick:()=>{T(-1)}})})]})]})})}export{te as default};
